<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Language Practice Hub</title>
  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background-color: #f7f9fc; color:#333;
      text-align:center;
      transition:0.4s;
      min-height:100vh;
      display:flex; flex-direction:column; align-items:center; padding:20px;
    }
    body.dark-mode { background:#121212; color:#f1f1f1; }
    h1 { font-weight:700; margin:15px 0 25px; }

    .menu { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-bottom:25px; }
    .menu button {
      background:#1a73e8; color:white; border:none; border-radius:10px;
      padding:10px 18px; cursor:pointer; font-size:1em; transition:0.25s;
    }
    .menu button.active { background:#0b5ed7; box-shadow:0 4px 8px rgba(0,0,0,0.2); }
    .menu button:hover { transform:translateY(-2px); }
    .dark-mode-icon { font-size:1.6em; cursor:pointer; margin-left:5px; }

    .section { display:none; width:100%; max-width:700px; margin-top:10px; }
    .visible { display:block; }

    .word { font-size:2em; margin:15px 0; color:#1a73e8; }
    input { padding:8px; font-size:1.2em; width:70%; border-radius:6px; border:1px solid #ccc; margin-bottom:10px; }
    button.action { background:#1a73e8; color:white; border:none; border-radius:6px; padding:10px 18px; font-size:1.1em; cursor:pointer; transition:0.25s; }
    button.action:hover { background:#155ab6; }
    .status { margin-top:10px; font-weight:bold; }
    .counter { margin-top:8px; font-weight:bold; }

    table { margin:20px auto; border-collapse:collapse; width:90%; max-width:500px; background:white; border-radius:8px; overflow:hidden; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    th, td { border:1px solid #ddd; padding:8px; font-size:0.95em; }
    th { background:#1a73e8; color:white; }
    body.dark-mode table { background:#1e1e1e; color:#f1f1f1; }
    body.dark-mode th { background:#0b5ed7; }

    .paragraph-card { background:white; box-shadow:0 4px 12px rgba(0,0,0,0.1); border-radius:10px; padding:20px; text-align:left; font-size:1.1em; line-height:1.8; color:#333; white-space:pre-wrap; margin-top:20px; }
    body.dark-mode .paragraph-card { background:#1e1e1e; color:#f1f1f1; }

    .chat-container { display:flex; flex-direction:column; gap:12px; margin-top:20px; text-align:left; }
    .bubble { padding:12px 16px; border-radius:14px; max-width:80%; line-height:1.6; word-wrap:break-word; }
    .xiaoli { background:#e8f0fe; align-self:flex-start; }
    .xiaowang { background:#d1ecf1; align-self:flex-end; }
    body.dark-mode .xiaoli { background:#2a2a72; color:white; }
    body.dark-mode .xiaowang { background:#2a7272; color:white; }

    @media (max-width:600px){ input{width:85%; font-size:1em;} .word{font-size:1.5em;} table{font-size:0.9em;} }
  </style>
</head>
<body>
  <h1>Language Practice Hub</h1>

  <div class="menu">
    <button id="menu-vocab" class="active" onclick="showSection('vocab')">Vocabulary Test</button>
    <button id="menu-paragraph" onclick="showSection('paragraph')">Paragraph</button>
    <button id="menu-conversation" onclick="showSection('conversation')">Conversation</button>
    <button id="menu-list" onclick="showSection('vocabList')">Vocabulary List</button>
    <button id="menu-retry" onclick="showSection('retry')">Retry</button>
    <span class="dark-mode-icon" onclick="toggleDarkMode()">üåô</span>
  </div>
  

  <!-- VOCAB TEST -->
  <div id="vocab" class="section visible">
    <label>Choose a Chapter:</label>
    <select id="chapterSelect" onchange="loadChapter()">
      <option value="">-- Select Chapter --</option>
    </select>

    <div class="word" id="word"></div>
    <input type="text" id="answer" placeholder="Type Chinese here">
    <button class="action" onclick="checkAnswer()">Check</button>

    <div class="status" id="status"></div>
    <div class="counter" id="counter"></div>

    <table id="wrongTable">
      <thead>
        <tr><th>English</th><th>Your Answer</th><th>Correct</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- PARAGRAPH -->
  <div id="paragraph" class="section">
    <h2>Paragraph Practice</h2>
    <select id="paragraphSelect" onchange="loadParagraph()">
      <option value="">-- Select Chapter --</option>
    </select>
    <div id="paragraphText" class="paragraph-card"></div>
  </div>

  <!-- CONVERSATION -->
  <div id="conversation" class="section">
    <h2>Conversation Practice</h2>
    <select id="conversationSelect" onchange="loadConversation()">
      <option value="">-- Select Chapter --</option>
    </select>
    <div id="conversationText" class="chat-container"></div>
  </div>

  <!-- VOCAB LIST -->
  <div id="vocabList" class="section"></div>

  <!-- RETRY SECTION -->
  <div id="retry" class="section">
    <h2>Retry Incorrect Words</h2>
    <br/>
    <button class="action" onclick="clearRetryHistory()">üóëÔ∏è Remove History</button>
    <table id="retryTable">
      <thead><tr><th>English</th><th>Correct Chinese</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    let vocabData = {}, paragraphData = {}, conversationData = {};
    let vocab = [], usedIndices = new Set(), current = {}, totalWords = 0;
    let wrongWords = JSON.parse(localStorage.getItem('wrongWords') || '[]');

    function toggleDarkMode(){ document.body.classList.toggle('dark-mode'); }

    // LOAD JSON FILES
    Promise.all([
      fetch('HSK 6.json').then(r=>r.json()),
      fetch('Paragraph.json').then(r=>r.json()),
      fetch('Conversation.json').then(r=>r.json())
    ])
    .then(([v,p,c])=>{
      vocabData=v; paragraphData=p; conversationData=c;
      populateDropdowns();
      updateRetryTable();
    });

    function populateDropdowns(){
      populateDropdown('chapterSelect',vocabData);
      populateDropdown('paragraphSelect',paragraphData);
      populateDropdown('conversationSelect',conversationData);
    }
    function populateDropdown(id,data){
      const select=document.getElementById(id);
      Object.keys(data).forEach(ch=>{
        const o=document.createElement('option');
        o.value=ch; o.textContent=ch;
        select.appendChild(o);
      });
    }

    function showSection(id){
      document.querySelectorAll('.section').forEach(s=>s.style.display='none');
      document.getElementById(id).style.display='block';
      document.querySelectorAll('.menu button').forEach(b=>b.classList.remove('active'));
      if(document.getElementById('menu-'+id)) document.getElementById('menu-'+id).classList.add('active');
      if(id==='vocabList') loadVocabList();
      if(id==='retry') updateRetryTable();
    }

    // VOCAB TEST
    function loadChapter(){
      const ch=document.getElementById('chapterSelect').value;
      if(!ch) return;
      vocab=vocabData[ch];
      usedIndices.clear();
      totalWords=vocab.length;
      document.querySelector('#wrongTable tbody').innerHTML='';
      showRandomWord();
    }
    function showRandomWord(){
      if(usedIndices.size===vocab.length){
        document.getElementById('word').textContent="üéâ All words done!";
        document.getElementById('answer').disabled=true;
        return;
      }
      let i;
      do{i=Math.floor(Math.random()*vocab.length);}while(usedIndices.has(i));
      usedIndices.add(i);
      current=vocab[i];
      document.getElementById('word').textContent=current.B;
      document.getElementById('answer').value='';
      document.getElementById('answer').disabled=false;
      document.getElementById('status').textContent='';
      updateCounter();
    }
    function checkAnswer(){
      const input=document.getElementById('answer').value.trim();
      if(!input){document.getElementById('status').textContent="‚ö†Ô∏è Please type!";return;}
      const correct=current.A.trim();
      if(input===correct){ document.getElementById('status').textContent="‚úÖ Correct!"; }
      else{
        document.getElementById('status').textContent=`‚ùå Wrong. Correct: ${correct}`;
        addWrongWord(current.B,input,correct);
      }
      setTimeout(showRandomWord,1500);
    }
    function addWrongWord(eng,user,correct){
      const tbody=document.querySelector('#wrongTable tbody');
      const row=document.createElement('tr');
      row.innerHTML=`<td>${eng}</td><td>${user}</td><td>${correct}</td>`;
      row.style.backgroundColor="#ffe6e6";
      tbody.appendChild(row);

      // Add to wrongWords only if not already present
      if(!wrongWords.some(w=>w.English===eng)){
        wrongWords.push({English:eng, Chinese:correct});
        localStorage.setItem('wrongWords',JSON.stringify(wrongWords));
      }
    }
    function updateCounter(){
      document.getElementById('counter').textContent=`Words Completed: ${usedIndices.size}/${totalWords}`;
    }

    // PARAGRAPH
    function loadParagraph(){
      const ch=document.getElementById('paragraphSelect').value;
      document.getElementById('paragraphText').textContent = ch ? paragraphData[ch] : '';
    }

    // CONVERSATION
    function loadConversation(){
      const ch=document.getElementById('conversationSelect').value;
      const container=document.getElementById('conversationText');
      container.innerHTML='';
      if(!ch)return;
      conversationData[ch].split('\n').forEach(line=>{
        const div=document.createElement('div');
        div.classList.add('bubble');
        if(line.startsWith('Â∞èÊùé')) div.classList.add('xiaoli');
        else if(line.startsWith('Â∞èÁéã')) div.classList.add('xiaowang');
        div.textContent=line.trim();
        container.appendChild(div);
      });
    }

    // VOCAB LIST
    function loadVocabList(){
      const c=document.getElementById('vocabList');
      c.innerHTML='<h2>Vocabulary List</h2>';
      for(const ch in vocabData){
        const h=document.createElement('h3');
        h.textContent=ch; c.appendChild(h);
        const t=document.createElement('table');
        t.innerHTML='<thead><tr><th>English</th><th>Chinese</th></tr></thead><tbody></tbody>';
        const tb=t.querySelector('tbody');
        vocabData[ch].forEach(w=>{
          const r=document.createElement('tr');
          r.innerHTML=`<td>${w.B}</td><td>${w.A}</td>`;
          tb.appendChild(r);
        });
        c.appendChild(t);
      }
    }

    // RETRY SECTION
    function updateRetryTable(){
      const tbody=document.querySelector('#retryTable tbody');
      tbody.innerHTML='';
      const seen = new Set();
      wrongWords.forEach(w=>{
        if(!seen.has(w.English)){
          seen.add(w.English);
          const r=document.createElement('tr');
          r.innerHTML=`<td>${w.English}</td><td>${w.Chinese}</td>`;
          tbody.appendChild(r);
        }
      });
    }

    function clearRetryHistory(){
      wrongWords=[];
      localStorage.removeItem('wrongWords');
      document.querySelector('#retryTable tbody').innerHTML='';
      alert("‚úÖ Retry history removed!");
    }
  </script>
</body>
</html>
